{{- $rawDesc := or .Description .Summary site.Params.tagline -}}
{{- $desc := $rawDesc | plainify -}}
{{- $title := cond .IsHome site.Title (printf "%s | %s" .Title site.Title) -}}
{{- $pageTitle := cond .IsHome site.Title .Title -}}
{{- $canonical := .Permalink -}}
{{- $langParts := split site.Language.LanguageCode "-" -}}
{{- $ogLocale := cond (gt (len $langParts) 1) (printf "%s_%s" (index $langParts 0) (upper (index $langParts 1))) (replace site.Language.LanguageCode "-" "_") -}}
{{- $ogType := cond (and .IsPage (eq .Section "posts")) "article" "website" -}}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
{{- if $desc }}
  <meta name="description" content="{{ $desc }}">
{{- end }}
<link rel="canonical" href="{{ $canonical }}">
<meta name="theme-color" content="#e4572e">
<link rel="icon" type="image/svg+xml" href="{{ "favicon.svg" | relURL }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ "favicon-32x32.png" | relURL }}">
<link rel="icon" type="image/png" sizes="64x64" href="{{ "favicon.png" | relURL }}">
<link rel="apple-touch-icon" sizes="180x180" href="{{ "apple-touch-icon.png" | relURL }}">
<title>{{ $title }}</title>

<meta property="og:site_name" content="{{ site.Title }}">
<meta property="og:title" content="{{ $pageTitle }}">
{{- if $desc }}
  <meta property="og:description" content="{{ $desc }}">
{{- end }}
<meta property="og:type" content="{{ $ogType }}">
<meta property="og:url" content="{{ $canonical }}">
<meta property="og:locale" content="{{ $ogLocale }}">
{{- if eq $ogType "article" }}
  {{- $published := .Date | time.Format "2006-01-02T15:04:05-07:00" -}}
  {{- $modified := (default .Date .Lastmod) | time.Format "2006-01-02T15:04:05-07:00" -}}
  <meta property="article:published_time" content="{{ $published }}">
  <meta property="article:modified_time" content="{{ $modified }}">
  {{- with .Params.categories }}
    <meta property="article:section" content="{{ index . 0 }}">
  {{- end }}
  {{- range .Params.tags }}
    <meta property="article:tag" content="{{ . }}">
  {{- end }}
{{- end }}

<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{ $pageTitle }}">
{{- if $desc }}
  <meta name="twitter:description" content="{{ $desc }}">
{{- end }}
<meta name="twitter:url" content="{{ $canonical }}">

{{- range .AlternativeOutputFormats }}
  <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink }}" title="{{ site.Title }}">
{{- end }}

{{- if .IsHome -}}
  {{- $schema := dict
    "@context" "https://schema.org"
    "@type" "WebSite"
    "name" site.Title
    "url" site.BaseURL
    "description" $desc
    "inLanguage" site.Language.LanguageCode
  -}}
  <script type="application/ld+json">{{ $schema | jsonify }}</script>
{{- else if and .IsPage (eq .Section "posts") -}}
  {{- $schema := dict
    "@context" "https://schema.org"
    "@type" "Article"
    "headline" $pageTitle
    "description" $desc
    "url" $canonical
    "datePublished" (.Date | time.Format "2006-01-02T15:04:05-07:00")
    "dateModified" ((default .Date .Lastmod) | time.Format "2006-01-02T15:04:05-07:00")
    "inLanguage" site.Language.LanguageCode
    "mainEntityOfPage" (dict "@type" "WebPage" "@id" $canonical)
    "publisher" (dict "@type" "Organization" "name" site.Title "url" site.BaseURL)
  -}}
  <script type="application/ld+json">{{ $schema | jsonify }}</script>
{{- else -}}
  {{- $schema := dict
    "@context" "https://schema.org"
    "@type" "WebPage"
    "name" $pageTitle
    "description" $desc
    "url" $canonical
    "inLanguage" site.Language.LanguageCode
    "isPartOf" (dict "@type" "WebSite" "name" site.Title "url" site.BaseURL)
  -}}
  <script type="application/ld+json">{{ $schema | jsonify }}</script>
{{- end }}

{{ partialCached "head/css.html" . }}
{{ partialCached "head/js.html" . }}
